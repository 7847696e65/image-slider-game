<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/><meta name="description" content="Image slider game"/><meta name="author" content="sniksnp"/><title>Image slider game</title><style>body{margin:0px;font-family:sans-serif;margin:auto;max-width:800px;}canvas{display:block;}#menu{height:40px;display:flex;align-items:center;}#menu button{height:30px;width:30px;margin:5px;background-color:rgba(0,0,0,0);border:1px solid #dddddd;color:#dddddd;}#menu span{color:#dddddd;}video{display:none;}#cameraCanvas{position:absolute;top:40px;z-index:-1;}</style><!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body><div id="menu"></div><canvas></canvas><video autoplay></video><script>var Directions={RIGHT:0,LEFT:1,UP:2,DOWN:3};var Size=function(a,b){var c=this;c.width=a,c.height=b};var Position=function(a,b){var c=this;c.x=a,c.y=b};var Clip=function(a,b){var c=this;c.pos=a,c.size=b};var MoveController=function(a,b){var c=this;c.nbOfTilesV=a,c.nbOfTilesH=b,c.moveIfPossible=function(a,b,d){var e=c.possibleMove(a,b);null!=e&&a[b].animateMove(e,function(){c.switchImages(a,b),d()})},c.switchImages=function(a,b){var d=c.getBlankTileIndex(a),e=a[d],f=a[b].clip,g=a[b].clipIndex;a[b].clip=e.clip,a[b].clipIndex=e.clipIndex,a[b].hidden=!0,e.clip=f,e.clipIndex=g,e.hidden=!1,a[b].draw(),e.draw()},c.possibleMove=function(a,b){for(var d=c.getSurroundingTiles(a,b),e=0;e<d.length;e++)if(d[e].hidden)return c.getMoveDirection(a,b);return null},c.getSurroundingTiles=function(a,b){var d=[],e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV;return 0==e?0==f?(d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b+c.nbOfTilesV])):(d.push(a[b-1]),d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):e==c.nbOfTilesH-1?0==f?(d.push(a[b+1]),d.push(a[b-c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):0==f?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b+1])):f==c.nbOfTilesV-1?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-1])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-c.nbOfTilesV])),d},c.getMoveDirection=function(a,b){var d=c.getBlankTileIndex(a),e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV,g=Math.floor(d/c.nbOfTilesV),h=d%c.nbOfTilesV;return e!=g?g>e?Directions.DOWN:Directions.UP:h>f?Directions.RIGHT:Directions.LEFT},c.getBlankTileIndex=function(a){for(var b=-1,c=0;c<a.length;c++)if(a[c].hidden){b=c;break}return b}};var Tile=function(a,b,c){var d=this;d.ctx=a,d.img=b,d.img.onClick=d.onclick,d.clipIndex=c,d.clip=null,d.size=null,d.pos=null,d.hidden=!1,d.velocity=1.5,d.acceleration=.001,d.exitAnimation=null,d.padding=5,d.startPos=null,d.setClip=function(a){d.clip=a},d.setSize=function(a){d.size=a},d.setPos=function(a){d.pos=a,d.startPos=new Position(a.x,a.y)},d.setHidden=function(a){d.hidden=a},d.draw=function(){d.ctx.clearRect(d.pos.x,d.pos.y,d.size.width,d.size.height),d.hidden||d.ctx.drawImage(d.img,d.clip.pos.x,d.clip.pos.y,d.clip.size.width,d.clip.size.height,d.pos.x+d.padding,d.pos.y+d.padding,d.size.width-2*d.padding,d.size.height-2*d.padding)},d.animateMove=function(a,b){var c=(new Date).getTime(),e=new Position(d.pos.x,d.pos.y);d.requestMoveAnimationFrame(c,e,a,b)},d.requestMoveAnimationFrame=function(a,b,c,e){var f=(new Date).getTime()-a;d.updatePos(f,c,b),d.draw(),d.exitAnimation?e():window.requestAnimationFrame(function(){d.requestMoveAnimationFrame(a,b,c,e)})},d.updatePos=function(a,b,c){b==Directions.RIGHT?d.updatePosRight(a,c):b==Directions.LEFT?d.updatePosLeft(a,c):b==Directions.UP?d.updatePosUp(a,c):b==Directions.DOWN&&d.updatePosDown(a,c)},d.updatePosRight=function(a,b){var c=b.x+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>d.startPos.x+d.size.width,d.pos.x=d.exitAnimation?d.startPos.x+d.size.width:c,d.ctx.clearRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosLeft=function(a,b){var c=b.x-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<d.startPos.x-d.size.width,d.pos.x=d.exitAnimation?d.startPos.x-d.size.width:c,d.ctx.clearRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosUp=function(a,b){var c=b.y-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<d.startPos.y-d.size.height,d.pos.y=d.exitAnimation?d.startPos.y-d.size.height:c,d.ctx.clearRect(d.pos.x,b.y,d.size.width,d.size.height)},d.updatePosDown=function(a,b){var c=b.y+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>d.startPos.y+d.size.height,d.pos.y=d.exitAnimation?d.startPos.y+d.size.height:c,d.ctx.clearRect(d.pos.x,b.y,d.size.width,d.size.height)},d.clear=function(){d.ctx.clearRect(d.pos.x+d.padding,d.pos.y+d.padding,d.size.width-2*d.padding,d.size.height-2*d.padding)},d.move=function(a,b,c,e){e==Directions.RIGHT?d.moveRight(a,b,c):e==Directions.LEFT?d.moveLeft(a,b,c):e==Directions.UP?d.moveUp(a,b,c):e==Directions.DOWN&&d.moveDown(a,b,c)},d.moveRight=function(a,b,c){var e=a.x+b.x-c.x;d.pos=e<d.startPos.x?new Position(d.startPos.x,a.y):e>d.startPos.x+d.size.width?new Position(d.startPos.x+d.size.width,a.y):new Position(e,a.y),d.ctx.clearRect(a.x,d.pos.y,2*d.size.width,d.size.height)},d.moveLeft=function(a,b,c){var e=a.x-(c.x-b.x);d.pos=e>d.startPos.x?new Position(d.startPos.x,a.y):e<d.startPos.x-d.size.width?new Position(d.startPos.x-d.size.width,a.y):new Position(e,a.y),d.ctx.clearRect(a.x-d.size.width,d.pos.y,2*d.size.width,d.size.height)},d.moveUp=function(a,b,c){var e=a.y-(c.y-b.y);d.pos=e>d.startPos.y?new Position(a.x,d.startPos.y):e<d.startPos.y-d.size.height?new Position(a.x,d.startPos.y-d.size.height):new Position(a.x,e),d.ctx.clearRect(d.pos.x,a.y-d.size.height,d.size.width,2*d.size.height)},d.moveDown=function(a,b,c){var e=a.y+b.y-c.y;d.pos=e<d.startPos.y?new Position(a.x,d.startPos.y):e>d.startPos.y+d.size.height?new Position(a.x,d.startPos.y+d.size.height):new Position(a.x,e),d.ctx.clearRect(d.pos.x,a.y,d.size.width,2*d.size.height)}};var Menu=function(){var a=this;a.div=document.querySelector("#menu"),a.height=parseInt(window.getComputedStyle(a.div).height),a.decNbOfTilesVButton=document.createElement("button"),a.nbOfTilesVText=document.createElement("span"),a.incNbOfTilesVButton=document.createElement("button"),a.decNbOfTilesHButton=document.createElement("button"),a.nbOfTilesHText=document.createElement("span"),a.incNbOfTilesHButton=document.createElement("button"),a.restartButton=document.createElement("button"),a.photoButton=document.createElement("button"),a.text=document.createElement("span"),a.setUp=function(){a.addNbOfTilesHButtons(),a.addNbOfTilesVButtons(),a.addRestartButton(),a.addPhotoButton(),a.addText()},a.addNbOfTilesVButtons=function(){a.decNbOfTilesVButton.innerHTML="-",a.div.appendChild(a.decNbOfTilesVButton),a.div.appendChild(a.nbOfTilesVText),a.incNbOfTilesVButton.innerHTML="+",a.div.appendChild(a.incNbOfTilesVButton)},a.setNbOfTilesVText=function(b){a.nbOfTilesVText.innerHTML=b},a.addNbOfTilesHButtons=function(){a.decNbOfTilesHButton.innerHTML="-",a.div.appendChild(a.decNbOfTilesHButton),a.div.appendChild(a.nbOfTilesHText),a.incNbOfTilesHButton.innerHTML="+",a.div.appendChild(a.incNbOfTilesHButton)},a.setNbOfTilesHText=function(b){a.nbOfTilesHText.innerHTML=b},a.addRestartButton=function(){a.restartButton.innerHTML="R",a.div.appendChild(a.restartButton)},a.addPhotoButton=function(){null!=navigator.getUserMedia&&(a.photoButton.innerHTML="P",a.div.appendChild(a.photoButton))},a.addText=function(){a.div.appendChild(a.text)},a.showText=function(b){a.text.style.display="inline",a.text.innerHTML=b},a.hideText=function(){a.text.style.display="none",a.text.innerHTML=""}};var ImageSliderGame=function(a,b,c){var d=this;d.imgSrc=a,d.nbOfTilesV=b,d.nbOfTilesH=c,d.tiles=[],d.canvas=document.querySelector("canvas"),d.ctx=d.canvas.getContext("2d"),d.img=new Image,d.tilesSize=null,d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.menu=new Menu,d.maxWidth=parseInt(window.getComputedStyle(document.querySelector("body")).maxWidth),d.bgImg=new Image,d.bgImgSrc="im/bg.jpg",d.video=document.querySelector("video"),d.localMediaStream=null,d.drawCameraImageInterval=null,d.showingCamera=!1,d.cameraCanvas=null,d.setUp=function(){d.resizeCanvas(),d.loadGameImages(),d.setUpNavigator()},d.setUpNavigator=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},d.resize=function(){d.resizeCanvas(),d.updateTiles()},d.resizeCanvas=function(){d.canvas.width=window.innerWidth<d.maxWidth?window.innerWidth:d.maxWidth,d.canvas.height=window.innerHeight-d.menu.height,d.cameraCanvas&&(d.cameraCanvas.width=d.canvas.width,d.cameraCanvas.height=d.canvas.height)},d.loadGameImages=function(){d.img.src=d.imgSrc,d.img.onload=function(){d.imgLoaded(d.img)},d.bgImg.src=d.bgImgSrc,d.bgImg.onload=function(){document.querySelector("body").style.backgroundImage="url("+d.bgImgSrc+")",d.imgLoaded(d.bgImg)}},d.imgLoaded=function(a){a.loaded=!0,d.startGame()},d.startGame=function(){d.img.loaded&&d.bgImg.loaded&&(d.setUpTiles(),d.shuffleTiles(),d.updateTiles(),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown),d.setUpMenu())},d.setUpMenu=function(){d.menu.setUp(),d.menu.decNbOfTilesVButton.addEventListener("click",d.decNbOfTilesV),d.menu.setNbOfTilesVText(d.nbOfTilesV),d.menu.incNbOfTilesVButton.addEventListener("click",d.incNbOfTilesV),d.menu.decNbOfTilesHButton.addEventListener("click",d.decNbOfTilesH),d.menu.setNbOfTilesHText(d.nbOfTilesH),d.menu.incNbOfTilesHButton.addEventListener("click",d.incNbOfTilesH),d.menu.restartButton.addEventListener("click",d.restart),d.menu.photoButton.addEventListener("click",d.showCamera)},d.decNbOfTilesV=function(){d.nbOfTilesV-1>1&&(d.nbOfTilesV--,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart())},d.incNbOfTilesV=function(){d.nbOfTilesV++,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart()},d.decNbOfTilesH=function(){d.nbOfTilesH-1>1&&(d.nbOfTilesH--,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart())},d.incNbOfTilesH=function(){d.nbOfTilesH++,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart()},d.showCamera=function(){d.menu.photoButton.removeEventListener("click",d.showCamera),d.menu.showText("Loading camera..."),navigator.getUserMedia({video:!0},function(a){d.video.src=window.URL.createObjectURL(a),d.localMediaStream=a,d.video.addEventListener("playing",d.drawCameraImage)},function(){d.menu.showText("Error while loading camera"),d.menu.photoButton.addEventListener("click",d.showCamera)})},d.drawCameraImage=function(){d.video.removeEventListener("playing",d.drawCameraImage),d.menu.showText("Click on video to take a picture!"),d.cameraCanvas=document.createElement("canvas"),d.cameraCanvas.setAttribute("id","cameraCanvas"),d.canvas.removeEventListener("mousedown",d.onCanvasMouseDown),d.canvas.removeEventListener("touchstart",d.onCanvasMouseDown),document.querySelector("body").appendChild(d.cameraCanvas);var a=d.cameraCanvas.getContext("2d");d.cameraCanvas.width=d.canvas.width,d.cameraCanvas.height=d.canvas.height,d.showingCamera=!0,d.ctx.fillStyle=d.ctx.createPattern(d.bgImg,"repeat"),d.ctx.fillRect(0,0,d.canvas.width,d.canvas.height);for(var b=0;b<d.tiles.length;b++)d.tiles[b].clear();d.drawCameraImageInterval=setInterval(function(){try{a.drawImage(d.video,0,0,d.cameraCanvas.width,d.cameraCanvas.height)}catch(b){return}d.canvas.addEventListener("click",d.takePicture)},100)},d.takePicture=function(){clearInterval(d.drawCameraImageInterval),d.menu.hideText(),d.canvas.removeEventListener("click",d.takePicture),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown),d.menu.photoButton.addEventListener("click",d.showCamera),d.img=new Image,d.img.onload=d.restart,d.img.src=d.cameraCanvas.toDataURL(),d.video.pause(),d.localMediaStream.stop(),d.localMediaStream=null,document.querySelector("body").removeChild(d.cameraCanvas),d.cameraCanvas=null,d.showingCamera=!1},d.restart=function(){d.menu.hideText(),d.tiles=[],d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height),d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.setUpTiles(),d.shuffleTiles(),d.updateTiles()},d.setUpTiles=function(){for(var a=d.nbOfTilesV*d.nbOfTilesH,b=parseInt(Math.random()*a),c=0;a>c;c++){var e=new Tile(d.ctx,d.img,c);c==b&&e.setHidden(!0),d.tiles.push(e)}},d.shuffleTiles=function(){for(var a,b,c=d.tiles.length;c;a=parseInt(Math.random()*c),b=d.tiles[--c],d.tiles[c]=d.tiles[a],d.tiles[a]=b);},d.updateTiles=function(){d.showingCamera&&(d.ctx.fillStyle=d.ctx.createPattern(d.bgImg,"repeat"),d.ctx.fillRect(0,0,d.canvas.width,d.canvas.height));for(var a=!0,b=0;b<d.tiles.length;b++){var c=d.tiles[b].clipIndex;c!=b&&(a=!1);var e=new Size(Math.floor(d.canvas.width/d.nbOfTilesV),Math.floor(d.canvas.height/d.nbOfTilesH)),f=new Position(b%d.nbOfTilesV*e.width,Math.floor(b/d.nbOfTilesV)*e.height),g=new Size(Math.floor(d.img.width/d.nbOfTilesV),Math.floor(d.img.height/d.nbOfTilesH)),h=new Position(c%d.nbOfTilesV*g.width,Math.floor(c/d.nbOfTilesV)*g.height);d.tilesSize=e,d.tiles[b].setPos(f),d.tiles[b].setSize(e),d.tiles[b].setClip(new Clip(h,g)),d.showingCamera?d.tiles[b].clear():d.tiles[b].draw()}if(a){d.menu.showText("Well done!");for(var b=0;b<d.tiles.length;b++)d.tiles[b].hidden&&(d.tiles[b].hidden=!1,d.tiles[b].draw())}},d.onCanvasMouseDown=function(a){var b=d.getMousePos(a);if(null!=b){var c=d.getTileIndex(b),e=new Position(d.tiles[c].pos.x,d.tiles[c].pos.y),f=d.moveController.possibleMove(d.tiles,c);d.onCanvasMouseMove=function(a){var g=d.getMousePos(a);null!=g&&(d.tiles[c].move(e,g,b,f),d.tiles[c].draw())},d.onCanvasMouseUp=function(){document.querySelector("html").removeEventListener("mouseup",d.onCanvasMouseUp),document.querySelector("html").removeEventListener("mouseout",d.onCanvasMouseUp),document.querySelector("html").removeEventListener("touchend",d.onCanvasMouseUp),d.canvas.removeEventListener("mousemove",d.onCanvasMouseMove),d.canvas.removeEventListener("touchmove",d.onCanvasMouseMove),d.moveController.moveIfPossible(d.tiles,c,d.endAnimation)},d.canvas.addEventListener("mousemove",d.onCanvasMouseMove),d.canvas.addEventListener("touchmove",d.onCanvasMouseMove),document.querySelector("html").addEventListener("mouseup",d.onCanvasMouseUp),document.querySelector("html").addEventListener("mouseout",d.onCanvasMouseUp),document.querySelector("html").addEventListener("touchend",d.onCanvasMouseUp)}},d.endAnimation=function(){d.updateTiles()},d.getTileIndex=function(a){var b=Math.floor(a.x/d.tilesSize.width),c=Math.floor(a.y/d.tilesSize.height);return b+c*d.nbOfTilesV},d.getMousePos=function(a){return"mousedown"==a.type||"mousemove"==a.type?new Position(a.clientX-d.canvas.offsetLeft,a.clientY-d.canvas.offsetTop):"touchstart"==a.type||"touchmove"==a.type?(a.preventDefault(),1==a.targetTouches.length?new Position(a.targetTouches[0].pageX-d.canvas.offsetLeft,a.targetTouches[0].pageY-d.canvas.offsetTop):null):void 0}};var game=new ImageSliderGame("im/chrome.jpg",3,4);window.onload=game.setUp,window.onresize=game.resize;</script></body></html>