<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="description" content="Image slider game"/><meta name="author" content="sniksnp"/><title>Image slider game</title><style>body{margin:0px;}canvas{display:block;}</style><!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body><canvas></canvas><script>var Directions={RIGHT:0,LEFT:1,UP:2,DOWN:3};var Dimensions=function(a,b){var c=this;c.width=a,c.height=b};var Position=function(a,b){var c=this;c.x=a,c.y=b};var Clip=function(a,b){var c=this;c.pos=a,c.dimensions=b};var MoveController=function(a,b){var c=this;c.numberOfSlicesVertical=a,c.numberOfSlicesHorizontal=b,c.moveIfPossible=function(a,b,d){var e=c.possibleMove(a,b);null!=e&&a[b].animateMove(e,function(){c.switchImages(a,b),d()})},c.switchImages=function(a,b){var d=c.getBlankSquareIndex(a),e=a[d],f=a[b].clip,g=a[b].clipIndex;a[b].clip=e.clip,a[b].clipIndex=e.clipIndex,a[b].hidden=!0,e.clip=f,e.clipIndex=g,e.hidden=!1,a[b].draw(),e.draw()},c.possibleMove=function(a,b){for(var d=c.getSurroundingSquares(a,b),e=0;e<d.length;e++)if(d[e].hidden)return c.getMoveDirection(a,b);return null},c.getSurroundingSquares=function(a,b){var d=[],e=Math.floor(b/c.numberOfSlicesVertical),f=b%c.numberOfSlicesVertical;return 0==e?0==f?(d.push(a[b+1]),d.push(a[b+c.numberOfSlicesVertical])):f==c.numberOfSlicesVertical-1?(d.push(a[b-1]),d.push(a[b+c.numberOfSlicesVertical])):(d.push(a[b-1]),d.push(a[b+1]),d.push(a[b+c.numberOfSlicesVertical])):e==c.numberOfSlicesHorizontal-1?0==f?(d.push(a[b+1]),d.push(a[b-c.numberOfSlicesVertical])):f==c.numberOfSlicesVertical-1?(d.push(a[b-1]),d.push(a[b-c.numberOfSlicesVertical])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b-c.numberOfSlicesVertical])):0==f?(d.push(a[b-c.numberOfSlicesVertical]),d.push(a[b+c.numberOfSlicesVertical]),d.push(a[b+1])):f==c.numberOfSlicesVertical-1?(d.push(a[b-c.numberOfSlicesVertical]),d.push(a[b+c.numberOfSlicesVertical]),d.push(a[b-1])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b+c.numberOfSlicesVertical]),d.push(a[b-c.numberOfSlicesVertical])),d},c.getMoveDirection=function(a,b){var d=c.getBlankSquareIndex(a),e=Math.floor(b/c.numberOfSlicesVertical),f=b%c.numberOfSlicesVertical,g=Math.floor(d/c.numberOfSlicesVertical),h=d%c.numberOfSlicesVertical;return e!=g?g>e?Directions.DOWN:Directions.UP:h>f?Directions.RIGHT:Directions.LEFT},c.getBlankSquareIndex=function(a){for(var b=-1,c=0;c<a.length;c++)if(a[c].hidden){b=c;break}return b}};var Square=function(a,b,c){var d=this;d.ctx=a,d.img=b,d.img.onClick=d.onclick,d.clipIndex=c,d.clip=null,d.dimensions=null,d.pos=null,d.hidden=!1,d.velocity=1.5,d.acceleration=.001,d.exitAnimation=null,d.setClip=function(a){d.clip=a},d.setDimensions=function(a){d.dimensions=a},d.setPos=function(a){d.pos=a},d.setHidden=function(a){d.hidden=a},d.draw=function(){d.ctx.clearRect(d.pos.x,d.pos.y,d.dimensions.width,d.dimensions.height),d.hidden||d.ctx.drawImage(d.img,d.clip.pos.x,d.clip.pos.y,d.clip.dimensions.width,d.clip.dimensions.height,d.pos.x,d.pos.y,d.dimensions.width,d.dimensions.height)},d.animateMove=function(a,b){var c=(new Date).getTime(),e=d.getCoef(a),f=new Position(d.pos.x,d.pos.y);d.requestMoveAnimationFrame(c,f,a,e,b)},d.getCoef=function(a){return a==Directions.RIGHT||a==Directions.DOWN?1:a==Directions.LEFT||a==Directions.UP?-1:void 0},d.requestMoveAnimationFrame=function(a,b,c,e,f){var g=(new Date).getTime()-a;d.updatePos(g,c,b),d.draw(),d.exitAnimation?f():window.requestAnimationFrame(function(){d.requestMoveAnimationFrame(a,b,c,e,f)})},d.updatePos=function(a,b,c){b==Directions.RIGHT?d.updatePosRight(a,c):b==Directions.LEFT?d.updatePosLeft(a,c):b==Directions.UP?d.updatePosUp(a,c):b==Directions.DOWN&&d.updatePosDown(a,c)},d.updatePosRight=function(a,b){var c=b.x+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>b.x+d.dimensions.width,d.pos.x=d.exitAnimation?b.x+d.dimensions.width:c,d.ctx.clearRect(b.x,d.pos.y,d.dimensions.width,d.dimensions.height)},d.updatePosLeft=function(a,b){var c=b.x-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<b.x-d.dimensions.width,d.pos.x=d.exitAnimation?b.x-d.dimensions.width:c,d.ctx.clearRect(b.x,d.pos.y,d.dimensions.width,d.dimensions.height)},d.updatePosUp=function(a,b){var c=b.y-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<b.y-d.dimensions.height,d.pos.y=d.exitAnimation?b.y-d.dimensions.height:c,d.ctx.clearRect(d.pos.x,b.y,d.dimensions.width,d.dimensions.height)},d.updatePosDown=function(a,b){var c=b.y+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>b.y+d.dimensions.height,d.pos.y=d.exitAnimation?b.y+d.dimensions.height:c,d.ctx.clearRect(d.pos.x,b.y,d.dimensions.width,d.dimensions.height)}};var ImageSliderGame=function(a,b,c){var d=this;d.imgSrc=a,d.numberOfSlicesVertical=b,d.numberOfSlicesHorizontal=c,d.squares=[],d.canvas=document.querySelector("canvas"),d.ctx=d.canvas.getContext("2d"),d.img=new Image,d.squareDimensions=null,d.moveController=new MoveController(b,c),d.setUp=function(){d.resizeCanvas(),d.loadImage()},d.resize=function(){d.resizeCanvas(),d.updateSquares()},d.resizeCanvas=function(){d.canvas.width=window.innerWidth,d.canvas.height=window.innerHeight},d.loadImage=function(){d.img.src=d.imgSrc,d.img.onload=d.startGame},d.startGame=function(){d.setUpSquares(),d.shuffleSquares(),d.updateSquares(),d.canvas.addEventListener("click",d.onCanvasClick)},d.setUpSquares=function(){for(var a=d.numberOfSlicesVertical*d.numberOfSlicesHorizontal,b=parseInt(Math.random()*a),c=0;a>c;c++){var e=new Square(d.ctx,d.img,c);c==b&&e.setHidden(!0),d.squares.push(e)}},d.shuffleSquares=function(){for(var a,b,c=d.squares.length;c;a=parseInt(Math.random()*c),b=d.squares[--c],d.squares[c]=d.squares[a],d.squares[a]=b);},d.updateSquares=function(){for(var a=0;a<d.squares.length;a++){var b=d.squares[a].clipIndex,c=new Dimensions(Math.floor(d.canvas.width/d.numberOfSlicesVertical),Math.floor(d.canvas.height/d.numberOfSlicesHorizontal)),e=new Position(a%d.numberOfSlicesVertical*c.width,Math.floor(a/d.numberOfSlicesVertical)*c.height),f=new Dimensions(Math.floor(d.img.width/d.numberOfSlicesVertical),Math.floor(d.img.height/d.numberOfSlicesHorizontal)),g=new Position(b%d.numberOfSlicesVertical*f.width,Math.floor(b/d.numberOfSlicesVertical)*f.height);d.squareDimensions=c,d.squares[a].setPos(e),d.squares[a].setDimensions(c),d.squares[a].setClip(new Clip(g,f)),d.squares[a].draw()}},d.onCanvasClick=function(a){var b=new Position(a.clientX,a.clientY),c=d.getSquareIndex(b);d.moveController.moveIfPossible(d.squares,c,d.endAnimation)},d.endAnimation=function(){d.updateSquares()},d.getSquareIndex=function(a){var b=Math.floor(a.x/d.squareDimensions.width),c=Math.floor(a.y/d.squareDimensions.height);return b+c*d.numberOfSlicesVertical}};var game=new ImageSliderGame("im/jquery-summit.png",3,4);window.onload=game.setUp,window.onresize=game.resize;</script></body></html>