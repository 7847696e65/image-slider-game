<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/><meta name="description" content="Image slider game"/><meta name="author" content="sniksnp"/><title>Image slider game</title><style>body{margin:0px;font-family:sans-serif;margin:auto;max-width:800px;}canvas{display:block;}#menu{height:40px;display:flex;align-items:center;}#menu button{height:30px;width:30px;margin:5px;border:none;}#menu button:focus{outline:none;}#menu span{color:white;}video{display:none;}#cameraCanvas{position:absolute;top:40px;z-index:-1;}input[type=file]{display:none;}</style><!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--></head><body><div id="menu"></div><canvas></canvas><video autoplay></video><script>var Directions={RIGHT:0,LEFT:1,UP:2,DOWN:3};var Size=function(a,b){var c=this;c.width=a,c.height=b};var Position=function(a,b){var c=this;c.x=a,c.y=b};var Clip=function(a,b){var c=this;c.pos=a,c.size=b};var Solver=function(a,b,c){var d=this;d.tiles=a,d.nbOfTilesV=b,d.nbOfTilesH=c,d.nbOfTiles=b*c-1,d.blnkx=-1,d.blnky=-1,d.clips=[],d.sol=[],d.solve=function(){for(var a=0;a<d.tiles.length;a++)d.clips.push(d.tiles[a].clipIndex),d.tiles[a].hidden&&(d.blnkx=a%b,d.blnky=Math.floor(a/b));return d.nPuzzleSolver(),d.sol},d.nPuzzleSolver=function(){for(var a=new Array,b=0;b<=d.nbOfTiles;b++)a[b]=d.clips[b];a[d.nbOfTiles+1]=d.blnkx,a[d.nbOfTiles+2]=d.blnky;for(var c=0,e=0;e<d.nbOfTilesH-2;e++){for(var f=0;f<d.nbOfTilesV;f++)d.movepiece(c+f,e,f);c+=d.nbOfTilesV}for(f=0;f<d.nbOfTilesV-2;f++){if(d.movepiece(c,d.nbOfTilesH-2,f),d.blnkx==f&&d.push(3),d.clips[c+d.nbOfTilesV]!=c+d.nbOfTilesV){for(d.movepiece(c+d.nbOfTilesV,d.nbOfTilesH-1,f+1),d.blnky!=d.nbOfTilesH-1&&(d.blnkx==f+1&&d.push(3),d.push(2));d.blnkx>f+2;)d.push(0);d.push(0,0,1,3,2,3,1,0,0,2,3)}c++}d.blnkx<d.nbOfTilesV-1&&d.push(3),d.blnky<d.nbOfTilesH-1&&d.push(2),c=d.nbOfTiles-d.nbOfTilesV-1,d.clips[c]==c+1&&d.push(1,0,2,3),d.clips[c]==c+d.nbOfTilesV&&d.push(0,1,3,2);for(var b=0;b<=d.nbOfTiles;b++)d.clips[b]=a[b];d.blnkx=a[d.nbOfTiles+1],d.blnky=a[d.nbOfTiles+2]},d.movepiece=function(a,b,c){for(var e=-1,f=0;f<d.nbOfTilesH;f++){for(var g=0;g<d.nbOfTilesV&&(e++,d.clips[e]!=a);g++);if(d.clips[e]==a)break}for(c>g&&d.blnky==b&&d.push(2);g>c;){for(d.blnky==f&&d.blnkx>g&&d.push(f==d.nbOfTilesH-1?1:2);d.blnkx>=g;)d.push(0);for(;d.blnkx<g-1;)d.push(3);for(;d.blnky<f;)d.push(2);for(;d.blnky>f;)d.push(1);d.push(3),g--}for(;c>g;){for(d.blnky==f&&d.blnkx<g&&d.push(f==d.nbOfTilesH-1?1:2);d.blnkx<=g;)d.push(3);for(;d.blnkx>g+1;)d.push(0);for(;d.blnky<f;)d.push(2);for(;d.blnky>f;)d.push(1);d.push(0),g++}for(;f>b;){if(f-1>b){for(;d.blnky<f-1;)d.push(2);for(d.blnkx==g&&d.push(g==d.nbOfTilesV-1?0:3);d.blnky>f-1;)d.push(1);for(;d.blnkx<g;)d.push(3);for(;d.blnkx>g;)d.push(0);d.push(2)}else if(g!=d.nbOfTilesV-1){for(d.blnky==f&&d.push(2);d.blnkx<g+1;)d.push(3);for(;d.blnkx>g+1;)d.push(0);for(;d.blnky>f-1;)d.push(1);for(;d.blnky<f-1;)d.push(2);d.push(0,2)}else if(d.blnky<f&&d.blnkx==g)for(;d.blnky<f;)d.push(2);else{for(;d.blnky>f+1;)d.push(1);for(;d.blnky<f+1;)d.push(2);for(;d.blnkx<g;)d.push(3);for(;d.blnkx>g;)d.push(0);d.push(1,1,0,2,3,2,0,1,1,3,2)}f--}for(;b>f;){for(d.blnkx==g&&d.blnky<f&&d.push(g==d.nbOfTilesV-1?0:3);d.blnky>f+1;)d.push(1);for(;d.blnky<f+1;)d.push(2);for(;d.blnkx<g;)d.push(3);for(;d.blnkx>g;)d.push(0);d.push(1),f++}},d.push=function(){for(var a=0;a<d.push.arguments.length;a++){var b=d.push.arguments[a];d.domove(b)}},d.domove=function(a){var b=d.blnkx+d.blnky*d.nbOfTilesV;0==a?(d.clips[b]=d.clips[b-1],d.clips[b-1]=d.nbOfTiles,d.blnkx--,d.sol.push(b-1)):1==a?(d.clips[b]=d.clips[b-d.nbOfTilesV],d.clips[b-d.nbOfTilesV]=d.nbOfTiles,d.blnky--,d.sol.push(b-d.nbOfTilesV)):2==a?b+d.nbOfTilesV<=d.nbOfTilesV*d.nbOfTilesH&&(d.clips[b]=d.clips[b+d.nbOfTilesV],d.clips[b+d.nbOfTilesV]=d.nbOfTiles,d.blnky++,d.sol.push(b+d.nbOfTilesV)):3==a&&(d.clips[b]=d.clips[b+1],d.clips[b+1]=d.nbOfTiles,d.blnkx++,d.sol.push(b+1))}};var MoveController=function(a,b){var c=this;c.nbOfTilesV=a,c.nbOfTilesH=b,c.moveIfPossible=function(a,b,d){var e=c.possibleMove(a,b);null!=e&&a[b].animateMove(e,function(){c.switchImages(a,b),d()})},c.switchImages=function(a,b){var d=c.getBlankTileIndex(a),e=a[d],f=a[b].clip,g=a[b].clipIndex;a[b].clip=e.clip,a[b].clipIndex=e.clipIndex,a[b].hidden=!0,e.clip=f,e.clipIndex=g,e.hidden=!1,a[b].draw(),e.draw()},c.possibleMove=function(a,b){for(var d=c.getSurroundingTiles(a,b),e=0;e<d.length;e++)if(d[e].hidden)return c.getMoveDirection(a,b);return null},c.getSurroundingTiles=function(a,b){var d=[],e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV;return 0==e?0==f?(d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b+c.nbOfTilesV])):(d.push(a[b-1]),d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):e==c.nbOfTilesH-1?0==f?(d.push(a[b+1]),d.push(a[b-c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):0==f?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b+1])):f==c.nbOfTilesV-1?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-1])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-c.nbOfTilesV])),d},c.getMoveDirection=function(a,b){var d=c.getBlankTileIndex(a),e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV,g=Math.floor(d/c.nbOfTilesV),h=d%c.nbOfTilesV;return e!=g?g>e?Directions.DOWN:Directions.UP:h>f?Directions.RIGHT:Directions.LEFT},c.getBlankTileIndex=function(a){for(var b=-1,c=0;c<a.length;c++)if(a[c].hidden){b=c;break}return b}};var Shuffler=function(){var a=this;a.mix=function(b,c){for(var d=null;null==d;)d=a.randomMix(b,c);return d},a.randomMix=function(b,c){for(var d=new MoveController(b,c),e=b*c,f=e-1,g=[],h=[],i=0;e>i;i++)g[i]=i,h[i]=i;for(var i=0;i<Math.floor(1e3*Math.random())+1e3;i++){var j=d.getSurroundingTiles(g,f),k=j[Math.floor(Math.random()*j.length)],l=h[k];h[k]=h[f],h[f]=l,f=k}return a.alreadySolved(h)?null:h},a.alreadySolved=function(a){for(var b=0;b<a.length;b++)if(a[b]!=b)return!1;return!0}};var Tile=function(a,b,c){var d=this;d.ctx=a,d.img=b,d.img.onClick=d.onclick,d.clipIndex=c,d.clip=null,d.size=null,d.pos=null,d.hidden=!1,d.velocity=1.5,d.acceleration=.001,d.exitAnimation=null,d.padding=5,d.startPos=null,d.setClip=function(a){d.clip=a},d.setSize=function(a){d.size=a},d.setPos=function(a){d.pos=a,d.startPos=new Position(a.x,a.y)},d.setHidden=function(a){d.hidden=a},d.draw=function(){d.ctx.clearRect(d.pos.x,d.pos.y,d.size.width,d.size.height),d.hidden||d.ctx.drawImage(d.img,d.clip.pos.x,d.clip.pos.y,d.clip.size.width,d.clip.size.height,d.pos.x+d.padding,d.pos.y+d.padding,d.size.width-2*d.padding,d.size.height-2*d.padding)},d.animateMove=function(a,b){var c=(new Date).getTime(),e=new Position(d.pos.x,d.pos.y);d.requestMoveAnimationFrame(c,e,a,b)},d.requestMoveAnimationFrame=function(a,b,c,e){var f=(new Date).getTime()-a;d.updatePos(f,c,b),d.draw(),d.exitAnimation?e():window.requestAnimationFrame(function(){d.requestMoveAnimationFrame(a,b,c,e)})},d.updatePos=function(a,b,c){b==Directions.RIGHT?d.updatePosRight(a,c):b==Directions.LEFT?d.updatePosLeft(a,c):b==Directions.UP?d.updatePosUp(a,c):b==Directions.DOWN&&d.updatePosDown(a,c)},d.updatePosRight=function(a,b){var c=b.x+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>d.startPos.x+d.size.width,d.pos.x=d.exitAnimation?d.startPos.x+d.size.width:c,d.ctx.clearRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosLeft=function(a,b){var c=b.x-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<d.startPos.x-d.size.width,d.pos.x=d.exitAnimation?d.startPos.x-d.size.width:c,d.ctx.clearRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosUp=function(a,b){var c=b.y-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<d.startPos.y-d.size.height,d.pos.y=d.exitAnimation?d.startPos.y-d.size.height:c,d.ctx.clearRect(d.pos.x,b.y,d.size.width,d.size.height)},d.updatePosDown=function(a,b){var c=b.y+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>d.startPos.y+d.size.height,d.pos.y=d.exitAnimation?d.startPos.y+d.size.height:c,d.ctx.clearRect(d.pos.x,b.y,d.size.width,d.size.height)},d.clear=function(){d.ctx.clearRect(d.pos.x+d.padding,d.pos.y+d.padding,d.size.width-2*d.padding,d.size.height-2*d.padding)},d.move=function(a,b,c,e){e==Directions.RIGHT?d.moveRight(a,b,c):e==Directions.LEFT?d.moveLeft(a,b,c):e==Directions.UP?d.moveUp(a,b,c):e==Directions.DOWN&&d.moveDown(a,b,c)},d.moveRight=function(a,b,c){var e=a.x+b.x-c.x;d.pos=e<d.startPos.x?new Position(d.startPos.x,a.y):e>d.startPos.x+d.size.width?new Position(d.startPos.x+d.size.width,a.y):new Position(e,a.y),d.ctx.clearRect(a.x,d.pos.y,2*d.size.width,d.size.height)},d.moveLeft=function(a,b,c){var e=a.x-(c.x-b.x);d.pos=e>d.startPos.x?new Position(d.startPos.x,a.y):e<d.startPos.x-d.size.width?new Position(d.startPos.x-d.size.width,a.y):new Position(e,a.y),d.ctx.clearRect(a.x-d.size.width,d.pos.y,2*d.size.width,d.size.height)},d.moveUp=function(a,b,c){var e=a.y-(c.y-b.y);d.pos=e>d.startPos.y?new Position(a.x,d.startPos.y):e<d.startPos.y-d.size.height?new Position(a.x,d.startPos.y-d.size.height):new Position(a.x,e),d.ctx.clearRect(d.pos.x,a.y-d.size.height,d.size.width,2*d.size.height)},d.moveDown=function(a,b,c){var e=a.y+b.y-c.y;d.pos=e<d.startPos.y?new Position(a.x,d.startPos.y):e>d.startPos.y+d.size.height?new Position(a.x,d.startPos.y+d.size.height):new Position(a.x,e),d.ctx.clearRect(d.pos.x,a.y,d.size.width,2*d.size.height)}};var Menu=function(){var a=this;a.div=document.querySelector("#menu"),a.height=parseInt(window.getComputedStyle(a.div).height),a.decNbOfTilesVButton=document.createElement("button"),a.nbOfTilesVText=document.createElement("span"),a.incNbOfTilesVButton=document.createElement("button"),a.decNbOfTilesHButton=document.createElement("button"),a.nbOfTilesHText=document.createElement("span"),a.incNbOfTilesHButton=document.createElement("button"),a.restartButton=document.createElement("button"),a.fileInput=document.createElement("input"),a.loadImageButton=document.createElement("button"),a.photoButton=document.createElement("button"),a.solveButton=document.createElement("button"),a.text=document.createElement("span"),a.setUp=function(){a.addNbOfTilesHButtons(),a.addNbOfTilesVButtons(),a.addRestartButton(),a.addLoadImageButton(),a.addPhotoButton(),a.addSolveButton(),a.addText()},a.addNbOfTilesVButtons=function(){a.decNbOfTilesVButton.style.background='url("im/dec.png")no-repeat center',a.div.appendChild(a.decNbOfTilesVButton),a.div.appendChild(a.nbOfTilesVText),a.incNbOfTilesVButton.style.background='url("im/inc.png")no-repeat center',a.div.appendChild(a.incNbOfTilesVButton)},a.setNbOfTilesVText=function(b){a.nbOfTilesVText.innerHTML=b},a.addNbOfTilesHButtons=function(){a.decNbOfTilesHButton.style.background='url("im/dec.png")no-repeat center',a.div.appendChild(a.decNbOfTilesHButton),a.div.appendChild(a.nbOfTilesHText),a.incNbOfTilesHButton.style.background='url("im/inc.png")no-repeat center',a.div.appendChild(a.incNbOfTilesHButton)},a.setNbOfTilesHText=function(b){a.nbOfTilesHText.innerHTML=b},a.addRestartButton=function(){a.restartButton.style.background='url("im/restart.png")no-repeat center',a.div.appendChild(a.restartButton)},a.addPhotoButton=function(){null!=navigator.getUserMedia&&(a.photoButton.style.background='url("im/photo.png")no-repeat center',a.div.appendChild(a.photoButton))},a.addText=function(){a.div.appendChild(a.text)},a.showText=function(b){a.text.style.display="inline",a.text.innerHTML=b},a.hideText=function(){a.text.style.display="none",a.text.innerHTML=""},a.addLoadImageButton=function(){a.fileInput.setAttribute("type","file"),a.div.appendChild(a.fileInput),a.loadImageButton.style.background='url("im/load.png")no-repeat center',a.div.appendChild(a.loadImageButton)},a.addSolveButton=function(){a.solveButton.style.background='url("im/solve.png")no-repeat center',a.div.appendChild(a.solveButton)}};var ImageSliderGame=function(a,b,c){var d=this;d.imgSrc=a,d.nbOfTilesV=b,d.nbOfTilesH=c,d.tiles=[],d.canvas=document.querySelector("canvas"),d.ctx=d.canvas.getContext("2d"),d.img=new Image,d.tilesSize=null,d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.menu=new Menu,d.maxWidth=parseInt(window.getComputedStyle(document.querySelector("body")).maxWidth),d.bgImg=new Image,d.bgImgSrc="im/bg.jpg",d.video=document.querySelector("video"),d.localMediaStream=null,d.drawCameraImageInterval=null,d.showingCamera=!1,d.cameraCanvas=null,d.setUp=function(){d.resizeCanvas(),d.loadGameImages(),d.setUpNavigator()},d.setUpNavigator=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},d.resize=function(){d.resizeCanvas(),d.updateTiles()},d.resizeCanvas=function(){d.canvas.width=window.innerWidth<d.maxWidth?window.innerWidth:d.maxWidth,d.canvas.height=window.innerHeight-d.menu.height,d.cameraCanvas&&(d.cameraCanvas.width=d.canvas.width,d.cameraCanvas.height=d.canvas.height)},d.loadGameImages=function(){d.img.src=d.imgSrc,d.img.onload=function(){d.imgLoaded(d.img)},d.bgImg.src=d.bgImgSrc,d.bgImg.onload=function(){document.querySelector("body").style.backgroundImage="url("+d.bgImgSrc+")",d.imgLoaded(d.bgImg)}},d.imgLoaded=function(a){a.loaded=!0,d.startGame()},d.startGame=function(){d.img.loaded&&d.bgImg.loaded&&(d.setUpTiles(),d.updateTiles(),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown),d.setUpMenu())},d.setUpMenu=function(){d.menu.setUp(),d.menu.decNbOfTilesVButton.addEventListener("click",d.decNbOfTilesV),d.menu.setNbOfTilesVText(d.nbOfTilesV),d.menu.incNbOfTilesVButton.addEventListener("click",d.incNbOfTilesV),d.menu.decNbOfTilesHButton.addEventListener("click",d.decNbOfTilesH),d.menu.setNbOfTilesHText(d.nbOfTilesH),d.menu.incNbOfTilesHButton.addEventListener("click",d.incNbOfTilesH),d.menu.restartButton.addEventListener("click",d.restart),d.menu.loadImageButton.addEventListener("click",d.loadImageFile),d.menu.photoButton.addEventListener("click",d.showCamera),d.menu.solveButton.addEventListener("click",d.solve)},d.decNbOfTilesV=function(){d.nbOfTilesV-1>2&&(d.nbOfTilesV--,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart())},d.incNbOfTilesV=function(){d.nbOfTilesV++,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart()},d.decNbOfTilesH=function(){d.nbOfTilesH-1>2&&(d.nbOfTilesH--,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart())},d.incNbOfTilesH=function(){d.nbOfTilesH++,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart()},d.showCamera=function(){d.menu.photoButton.removeEventListener("click",d.showCamera),d.menu.showText("Loading camera..."),navigator.getUserMedia({video:!0},function(a){d.video.src=window.URL.createObjectURL(a),d.localMediaStream=a,d.video.addEventListener("playing",d.drawCameraImage)},function(){d.menu.showText("Error while loading camera"),d.menu.photoButton.addEventListener("click",d.showCamera)})},d.drawCameraImage=function(){d.video.removeEventListener("playing",d.drawCameraImage),d.menu.showText("Click on video to take a picture!"),d.cameraCanvas=document.createElement("canvas"),d.cameraCanvas.setAttribute("id","cameraCanvas"),d.canvas.removeEventListener("mousedown",d.onCanvasMouseDown),d.canvas.removeEventListener("touchstart",d.onCanvasMouseDown),document.querySelector("body").appendChild(d.cameraCanvas);var a=d.cameraCanvas.getContext("2d");d.cameraCanvas.width=d.canvas.width,d.cameraCanvas.height=d.canvas.height,d.showingCamera=!0,d.ctx.fillStyle=d.ctx.createPattern(d.bgImg,"repeat"),d.ctx.fillRect(0,0,d.canvas.width,d.canvas.height);for(var b=0;b<d.tiles.length;b++)d.tiles[b].clear();d.drawCameraImageInterval=setInterval(function(){try{a.drawImage(d.video,0,0,d.cameraCanvas.width,d.cameraCanvas.height)}catch(b){return}d.canvas.addEventListener("click",d.takePicture)},100)},d.takePicture=function(){clearInterval(d.drawCameraImageInterval),d.menu.hideText(),d.canvas.removeEventListener("click",d.takePicture),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown),d.menu.photoButton.addEventListener("click",d.showCamera),d.img=new Image,d.img.onload=d.restart,d.img.src=d.cameraCanvas.toDataURL(),d.video.pause(),d.localMediaStream.stop(),d.localMediaStream=null,document.querySelector("body").removeChild(d.cameraCanvas),d.cameraCanvas=null,d.showingCamera=!1},d.restart=function(){d.menu.hideText(),d.tiles=[],d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height),d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.setUpTiles(),d.updateTiles()},d.loadImageFile=function(){d.menu.fileInput.addEventListener("change",d.onImageSelect),d.menu.fileInput.click()},d.onImageSelect=function(){d.menu.fileInput.removeEventListener("change",d.onImageChange);var a=new FileReader;a.onload=function(){d.img=new Image,d.img.onload=d.restart,d.img.src=a.result},a.readAsDataURL(d.menu.fileInput.files[0])},d.setUpTiles=function(){for(var a=d.nbOfTilesV*d.nbOfTilesH,b=(new Shuffler).mix(d.nbOfTilesV,d.nbOfTilesH),c=0;a>c;c++){var e=new Tile(d.ctx,d.img,b[c]);b[c]==a-1&&e.setHidden(!0),d.tiles.push(e)}},d.updateTiles=function(){d.showingCamera&&(d.ctx.fillStyle=d.ctx.createPattern(d.bgImg,"repeat"),d.ctx.fillRect(0,0,d.canvas.width,d.canvas.height));for(var a=!0,b=0;b<d.tiles.length;b++){var c=d.tiles[b].clipIndex;c!=b&&(a=!1);var e=new Size(Math.floor(d.canvas.width/d.nbOfTilesV),Math.floor(d.canvas.height/d.nbOfTilesH)),f=new Position(b%d.nbOfTilesV*e.width,Math.floor(b/d.nbOfTilesV)*e.height),g=new Size(Math.floor(d.img.width/d.nbOfTilesV),Math.floor(d.img.height/d.nbOfTilesH)),h=new Position(c%d.nbOfTilesV*g.width,Math.floor(c/d.nbOfTilesV)*g.height);d.tilesSize=e,d.tiles[b].setPos(f),d.tiles[b].setSize(e),d.tiles[b].setClip(new Clip(h,g)),d.showingCamera?d.tiles[b].clear():d.tiles[b].draw()}if(a){d.menu.showText("Well done!");for(var b=0;b<d.tiles.length;b++)d.tiles[b].hidden&&(d.tiles[b].hidden=!1),d.tiles[b].padding=0,d.tiles[b].draw()}},d.onCanvasMouseDown=function(a){var b=d.getMousePos(a);if(null!=b){var c=d.getTileIndex(b),e=new Position(d.tiles[c].pos.x,d.tiles[c].pos.y),f=d.moveController.possibleMove(d.tiles,c);null!=f&&(d.onCanvasMouseMove=function(a){var g=d.getMousePos(a);null!=g&&(d.tiles[c].move(e,g,b,f),d.tiles[c].draw())},d.onCanvasMouseUp=function(){document.querySelector("html").removeEventListener("mouseup",d.onCanvasMouseUp),document.querySelector("html").removeEventListener("mouseout",d.onCanvasMouseUp),document.querySelector("html").removeEventListener("touchend",d.onCanvasMouseUp),d.canvas.removeEventListener("mousemove",d.onCanvasMouseMove),d.canvas.removeEventListener("touchmove",d.onCanvasMouseMove),d.moveController.moveIfPossible(d.tiles,c,d.endAnimation)},d.canvas.addEventListener("mousemove",d.onCanvasMouseMove),d.canvas.addEventListener("touchmove",d.onCanvasMouseMove),document.querySelector("html").addEventListener("mouseup",d.onCanvasMouseUp),document.querySelector("html").addEventListener("mouseout",d.onCanvasMouseUp),document.querySelector("html").addEventListener("touchend",d.onCanvasMouseUp),d.canvas.removeEventListener("mousedown",d.onCanvasMouseDown),d.canvas.removeEventListener("touchstart",d.onCanvasMouseDown))}},d.endAnimation=function(){d.updateTiles(),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown)},d.getTileIndex=function(a){var b=Math.floor(a.x/d.tilesSize.width),c=Math.floor(a.y/d.tilesSize.height);return b+c*d.nbOfTilesV},d.getMousePos=function(a){return"mousedown"==a.type||"mousemove"==a.type?new Position(a.clientX-d.canvas.offsetLeft,a.clientY-d.canvas.offsetTop):"touchstart"==a.type||"touchmove"==a.type?(a.preventDefault(),1==a.targetTouches.length?new Position(a.targetTouches[0].pageX-d.canvas.offsetLeft,a.targetTouches[0].pageY-d.canvas.offsetTop):null):void 0},d.solve=function(){d.canvas.removeEventListener("mousedown",d.onCanvasMouseDown),d.canvas.removeEventListener("touchstart",d.onCanvasMouseDown),d.menu.decNbOfTilesVButton.removeEventListener("click",d.decNbOfTilesV),d.menu.incNbOfTilesVButton.removeEventListener("click",d.incNbOfTilesV),d.menu.decNbOfTilesHButton.removeEventListener("click",d.decNbOfTilesH),d.menu.incNbOfTilesHButton.removeEventListener("click",d.incNbOfTilesH),d.menu.restartButton.removeEventListener("click",d.restart),d.menu.loadImageButton.removeEventListener("click",d.loadImageFile),d.menu.photoButton.removeEventListener("click",d.showCamera),d.menu.solveButton.removeEventListener("click",d.solve),d.menu.showText("Solving puzzle...");var a=new Solver(d.tiles,d.nbOfTilesV,d.nbOfTilesH).solve();try{d.solveAnimationStep(a,0,d.updateTiles,d.endSolveAnimation)}catch(b){d.endSolveAnimation()}},d.solveAnimationStep=function(a,b,c,e){b<a.length?(d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.moveController.moveIfPossible(d.tiles,a[b],function(){c(),setTimeout(function(){d.solveAnimationStep(a,b+1,c,e)},100)})):e()},d.endSolveAnimation=function(){d.updateTiles(),d.canvas.addEventListener("mousedown",d.onCanvasMouseDown),d.canvas.addEventListener("touchstart",d.onCanvasMouseDown),d.menu.decNbOfTilesVButton.addEventListener("click",d.decNbOfTilesV),d.menu.incNbOfTilesVButton.addEventListener("click",d.incNbOfTilesV),d.menu.decNbOfTilesHButton.addEventListener("click",d.decNbOfTilesH),d.menu.incNbOfTilesHButton.addEventListener("click",d.incNbOfTilesH),d.menu.restartButton.addEventListener("click",d.restart),d.menu.loadImageButton.addEventListener("click",d.loadImageFile),d.menu.photoButton.addEventListener("click",d.showCamera),d.menu.solveButton.addEventListener("click",d.solve)}};var game=new ImageSliderGame("im/chrome.jpg",4,4);window.onload=game.setUp,window.onresize=game.resize;</script></body></html>