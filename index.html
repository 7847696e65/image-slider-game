<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0"/><meta name="description" content="Image slider game"/><meta name="author" content="sniksnp"/><title>Image slider game</title><style>body{margin:0px;font-family:sans-serif;background-color:white;margin:auto;max-width:800px;}canvas{display:block;}#menu{height:40px;display:flex;align-items:center;}#menu button{height:30px;width:30px;margin:10px;}#menu span{color:black;}</style><!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head><body><div id="menu"></div><canvas></canvas><script>var Directions={RIGHT:0,LEFT:1,UP:2,DOWN:3};var Size=function(a,b){var c=this;c.width=a,c.height=b};var Position=function(a,b){var c=this;c.x=a,c.y=b};var Clip=function(a,b){var c=this;c.pos=a,c.size=b};var MoveController=function(a,b){var c=this;c.nbOfTilesV=a,c.nbOfTilesH=b,c.moveIfPossible=function(a,b,d){var e=c.possibleMove(a,b);null!=e&&a[b].animateMove(e,function(){c.switchImages(a,b),d()})},c.switchImages=function(a,b){var d=c.getBlankTileIndex(a),e=a[d],f=a[b].clip,g=a[b].clipIndex;a[b].clip=e.clip,a[b].clipIndex=e.clipIndex,a[b].hidden=!0,e.clip=f,e.clipIndex=g,e.hidden=!1,a[b].draw(),e.draw()},c.possibleMove=function(a,b){for(var d=c.getSurroundingTiles(a,b),e=0;e<d.length;e++)if(d[e].hidden)return c.getMoveDirection(a,b);return null},c.getSurroundingTiles=function(a,b){var d=[],e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV;return 0==e?0==f?(d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b+c.nbOfTilesV])):(d.push(a[b-1]),d.push(a[b+1]),d.push(a[b+c.nbOfTilesV])):e==c.nbOfTilesH-1?0==f?(d.push(a[b+1]),d.push(a[b-c.nbOfTilesV])):f==c.nbOfTilesV-1?(d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b-c.nbOfTilesV])):0==f?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b+1])):f==c.nbOfTilesV-1?(d.push(a[b-c.nbOfTilesV]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-1])):(d.push(a[b+1]),d.push(a[b-1]),d.push(a[b+c.nbOfTilesV]),d.push(a[b-c.nbOfTilesV])),d},c.getMoveDirection=function(a,b){var d=c.getBlankTileIndex(a),e=Math.floor(b/c.nbOfTilesV),f=b%c.nbOfTilesV,g=Math.floor(d/c.nbOfTilesV),h=d%c.nbOfTilesV;return e!=g?g>e?Directions.DOWN:Directions.UP:h>f?Directions.RIGHT:Directions.LEFT},c.getBlankTileIndex=function(a){for(var b=-1,c=0;c<a.length;c++)if(a[c].hidden){b=c;break}return b}};var Tile=function(a,b,c){var d=this;d.ctx=a,d.img=b,d.img.onClick=d.onclick,d.clipIndex=c,d.clip=null,d.size=null,d.pos=null,d.hidden=!1,d.velocity=1.5,d.acceleration=.001,d.exitAnimation=null,d.setClip=function(a){d.clip=a},d.setSize=function(a){d.size=a},d.setPos=function(a){d.pos=a},d.setHidden=function(a){d.hidden=a},d.setCtxFillStyle=function(a){d.ctx.fillStyle=a},d.draw=function(){d.ctx.clearRect(d.pos.x,d.pos.y,d.size.width,d.size.height),d.hidden?d.ctx.fillRect(d.pos.x,d.pos.y,d.size.width,d.size.height):d.ctx.drawImage(d.img,d.clip.pos.x,d.clip.pos.y,d.clip.size.width,d.clip.size.height,d.pos.x,d.pos.y,d.size.width,d.size.height)},d.animateMove=function(a,b){var c=(new Date).getTime(),e=d.getCoef(a),f=new Position(d.pos.x,d.pos.y);d.requestMoveAnimationFrame(c,f,a,e,b)},d.getCoef=function(a){return a==Directions.RIGHT||a==Directions.DOWN?1:a==Directions.LEFT||a==Directions.UP?-1:void 0},d.requestMoveAnimationFrame=function(a,b,c,e,f){var g=(new Date).getTime()-a;d.updatePos(g,c,b),d.draw(),d.exitAnimation?f():window.requestAnimationFrame(function(){d.requestMoveAnimationFrame(a,b,c,e,f)})},d.updatePos=function(a,b,c){b==Directions.RIGHT?d.updatePosRight(a,c):b==Directions.LEFT?d.updatePosLeft(a,c):b==Directions.UP?d.updatePosUp(a,c):b==Directions.DOWN&&d.updatePosDown(a,c)},d.updatePosRight=function(a,b){var c=b.x+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>b.x+d.size.width,d.pos.x=d.exitAnimation?b.x+d.size.width:c,d.ctx.fillRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosLeft=function(a,b){var c=b.x-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<b.x-d.size.width,d.pos.x=d.exitAnimation?b.x-d.size.width:c,d.ctx.fillRect(b.x,d.pos.y,d.size.width,d.size.height)},d.updatePosUp=function(a,b){var c=b.y-a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c<b.y-d.size.height,d.pos.y=d.exitAnimation?b.y-d.size.height:c,d.ctx.fillRect(d.pos.x,b.y,d.size.width,d.size.height)},d.updatePosDown=function(a,b){var c=b.y+a*(d.velocity+d.acceleration*a/2);d.exitAnimation=c>b.y+d.size.height,d.pos.y=d.exitAnimation?b.y+d.size.height:c,d.ctx.fillRect(d.pos.x,b.y,d.size.width,d.size.height)}};var Menu=function(){var a=this;a.div=document.querySelector("#menu"),a.height=parseInt(window.getComputedStyle(a.div).height),a.decNbOfTilesVButton=null,a.nbOfTilesVText=null,a.incNbOfTilesVButton=null,a.decNbOfTilesHButton=null,a.nbOfTilesHText=null,a.incNbOfTilesHButton=null,a.restartButton=null,a.setUp=function(){a.addNbOfTilesVButtons(),a.addNbOfTilesHButtons(),a.addRestartButton()},a.addNbOfTilesVButtons=function(){a.decNbOfTilesVButton=document.createElement("button"),a.decNbOfTilesVButton.innerHTML="-",a.div.appendChild(a.decNbOfTilesVButton),a.nbOfTilesVText=document.createElement("span"),a.div.appendChild(a.nbOfTilesVText),a.incNbOfTilesVButton=document.createElement("button"),a.incNbOfTilesVButton.innerHTML="+",a.div.appendChild(a.incNbOfTilesVButton)},a.setNbOfTilesVText=function(b){a.nbOfTilesVText.innerHTML=b},a.addNbOfTilesHButtons=function(){a.decNbOfTilesHButton=document.createElement("button"),a.decNbOfTilesHButton.innerHTML="-",a.div.appendChild(a.decNbOfTilesHButton),a.nbOfTilesHText=document.createElement("span"),a.div.appendChild(a.nbOfTilesHText),a.incNbOfTilesHButton=document.createElement("button"),a.incNbOfTilesHButton.innerHTML="+",a.div.appendChild(a.incNbOfTilesHButton)},a.setNbOfTilesHText=function(b){a.nbOfTilesHText.innerHTML=b},a.addRestartButton=function(){a.restartButton=document.createElement("button"),a.restartButton.innerHTML="R",a.div.appendChild(a.restartButton)}};var ImageSliderGame=function(a,b,c){var d=this;d.imgSrc=a,d.nbOfTilesV=b,d.nbOfTilesH=c,d.tiles=[],d.canvas=document.querySelector("canvas"),d.ctx=d.canvas.getContext("2d"),d.img=new Image,d.tilesSize=null,d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.menu=new Menu,d.maxWidth=parseInt(window.getComputedStyle(document.querySelector("body")).maxWidth),d.blankTileColor="#00ff00",d.setUp=function(){d.resizeCanvas(),d.loadImage()},d.resize=function(){d.resizeCanvas(),d.updateTiles()},d.resizeCanvas=function(){d.canvas.width=window.innerWidth<d.maxWidth?window.innerWidth:d.maxWidth,d.canvas.height=window.innerHeight-d.menu.height},d.loadImage=function(){d.img.src=d.imgSrc,d.img.onload=d.startGame},d.startGame=function(){d.setUpTiles(),d.shuffleTiles(),d.updateTiles(),d.canvas.addEventListener("click",d.onCanvasClick),d.setUpMenu()},d.setUpMenu=function(){d.menu.setUp(),d.menu.decNbOfTilesVButton.addEventListener("click",d.decNbOfTilesV),d.menu.setNbOfTilesVText(d.nbOfTilesV),d.menu.incNbOfTilesVButton.addEventListener("click",d.incNbOfTilesV),d.menu.decNbOfTilesHButton.addEventListener("click",d.decNbOfTilesH),d.menu.setNbOfTilesHText(d.nbOfTilesH),d.menu.incNbOfTilesHButton.addEventListener("click",d.incNbOfTilesH),d.menu.restartButton.addEventListener("click",d.restart)},d.decNbOfTilesV=function(){d.nbOfTilesV-1>1&&(d.nbOfTilesV--,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart())},d.incNbOfTilesV=function(){d.nbOfTilesV++,d.menu.setNbOfTilesVText(d.nbOfTilesV),d.restart()},d.decNbOfTilesH=function(){d.nbOfTilesH-1>1&&(d.nbOfTilesH--,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart())},d.incNbOfTilesH=function(){d.nbOfTilesH++,d.menu.setNbOfTilesHText(d.nbOfTilesH),d.restart()},d.restart=function(){d.tiles=[],d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height),d.moveController=new MoveController(d.nbOfTilesV,d.nbOfTilesH),d.setUpTiles(),d.shuffleTiles(),d.updateTiles()},d.setUpTiles=function(){for(var a=d.nbOfTilesV*d.nbOfTilesH,b=parseInt(Math.random()*a),c=0;a>c;c++){var e=new Tile(d.ctx,d.img,c);c==b&&e.setHidden(!0),d.tiles.push(e)}},d.shuffleTiles=function(){for(var a,b,c=d.tiles.length;c;a=parseInt(Math.random()*c),b=d.tiles[--c],d.tiles[c]=d.tiles[a],d.tiles[a]=b);},d.updateTiles=function(){for(var a=0;a<d.tiles.length;a++){var b=d.tiles[a].clipIndex,c=new Size(Math.floor(d.canvas.width/d.nbOfTilesV),Math.floor(d.canvas.height/d.nbOfTilesH)),e=new Position(a%d.nbOfTilesV*c.width,Math.floor(a/d.nbOfTilesV)*c.height),f=new Size(Math.floor(d.img.width/d.nbOfTilesV),Math.floor(d.img.height/d.nbOfTilesH)),g=new Position(b%d.nbOfTilesV*f.width,Math.floor(b/d.nbOfTilesV)*f.height);d.tilesSize=c,d.tiles[a].setCtxFillStyle(d.blankTileColor),d.tiles[a].setPos(e),d.tiles[a].setSize(c),d.tiles[a].setClip(new Clip(g,f)),d.tiles[a].draw()}},d.onCanvasClick=function(a){var b=new Position(a.clientX-d.canvas.offsetLeft,a.clientY-d.canvas.offsetTop),c=d.getTileIndex(b);d.moveController.moveIfPossible(d.tiles,c,d.endAnimation)},d.endAnimation=function(){d.updateTiles()},d.getTileIndex=function(a){var b=Math.floor(a.x/d.tilesSize.width),c=Math.floor(a.y/d.tilesSize.height);return b+c*d.nbOfTilesV}};var game=new ImageSliderGame("im/chrome.png",3,4);window.onload=game.setUp,window.onresize=game.resize;</script></body></html>